{% extends "base.html" %}

{% block title %}
    Welcome!
{% endblock %}

{% block main %}
<article class="greeting">
    <h1>Welcome to Galaxi!</h1>
</article>
<div class="posts">
{% for post in posts %}
<article id="{{post[0] | safe}}" class="post">
    <a class='profile_link' href="/profile/{{ post[1] | safe}}">{{ post[1] | safe}}</a>
    <p>{{ post[2] | safe }}</p>
   <div class='post_info'> <div id='likes_{{post[0]}}' onclick='change("likes", "{{post[0]}}", "posts")'><span class="fa-solid fa-thumbs-up{% if post[5] and user_id in post[5] %} interacted{% endif %}"></span><p> {{ post[6] }} </p></div> <div id='dislikes_{{post[0]}}' onclick='change("dislikes", "{{post[0]}}", "posts")'><span class="fa-solid fa-thumbs-down{% if post[3] and user_id in post[3] %} interacted{% endif %}"></span><p> {{ post[7] }} </p></div><div id='comments_{{post[0]}}' onclick="window.location.href='post/{{post[0]}}'"><span class="fa-solid fa-comments"></span> <p id='comments'> {{ post[8] }} </p></div></div>
</article>
{% endfor %}
</div>
<div class='center'>
<p>You've reached the end of this planetary system. Would you like to turn your ship around and head to the top of the page?</p>
<button onclick=to_top();>Back to Top</button>
</div>
<script>


function change(action, thing_id, table) {
    const post = document.getElementById(action+"_"+thing_id);
    const children = post.childNodes;
    console.log(children)
    const icon = children[0];
    const count = children[1];
    let sign = 0;
    let value = 0;
    icon.classList.toggle("interacted");
    
    if ("interacted" == icon.classList[(icon.classList["length"]-1)]){
        sign = 1;
    } else {
        sign = -1;
    };
    value = String(Number(count.textContent) + sign);
    count.textContent = " " + value + " ";
    const formData = new FormData();
    formData.append('action', action);
    formData.append('thing_id', thing_id);
    formData.append('sign', sign);
    formData.append('value', value);
    formData.append('table', 'posts');
    fetch('/interactions', {
        method: 'POST',
        body: formData,
    });
    //two reloads to make sure it actually works
    
};

function to_top(){
    window.scrollTo({
        top: 0,
        behaviour:'smooth'
    });
}



</script>
{% endblock %}


