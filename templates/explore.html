{% extends "base.html" %}

{% block title %}
    Explore
{% endblock %}

{% block main %}
<div class='center'>
<form action='/explore', method='post'>
    <input name='term' class='searchbar' type='text' id='searchbar' autocomplete="off" placeholder="Search...">
</form>
<p class='center'>{{ message }}</p>
</div>
{% for user in users %}
<div class='center profile_box'>
<article id="{{ user.get_username() | safe }}" class="account">
    <a class='profile_link' href="/profile/{{ user.get_username() | safe}}">{{ user.get_username() | safe}}</a>
    <p>{{ user.get_post_count() }} posts made</p>
</div>
{% endfor %}
{% if posts and users %}<hr></hr>{% endif %}
<div class='posts'>
{% for post in posts %}
<article id="{{ post[0] | safe }}" class="post">
    <a class='profile_link' href="/profile/{{ post[1] | safe}}">{{ post[1] | safe}}</a>
    <p>{{ post[2] | safe }}</p>
   <div class='post_info'> <div id='likes_{{ post[0] }}' onclick='change("likes", "{{post[0]}}", "posts")'><span class="fa-solid fa-thumbs-up{% if post[5] and user_id in post[5] %} interacted{% endif %}"></span><p> {{ post[6] }} </p></div> <div id='dislikes_{{post[0]}}' onclick='change("dislikes", "{{ post[0] }}", "posts")'><span class="fa-solid fa-thumbs-down{% if post[3] and user_id in post[3] %} interacted{% endif %}"></span><p> {{ post[7] }} </p></div><div id='comments_{{post[0]}}' onclick="window.location.href='post/{{post[0]}}'"><span class="fa-solid fa-comments"></span> <p id='comments'> {{ post[8] }} </p></div></div>
</article>
{% endfor %}
</div>
<script>
function change(action, thing_id, table) {
    const post = document.getElementById(action+"_"+thing_id);
    const children = post.childNodes;
    console.log(children)
    const icon = children[0];
    const count = children[1];
    let sign = 0;
    let value = 0;
    icon.classList.toggle("interacted");
    
    if ("interacted" == icon.classList[(icon.classList["length"]-1)]){
        sign = 1;
    } else {
        sign = -1;
    };
    value = String(Number(count.textContent) + sign);
    count.textContent = " " + value + " ";
    const formData = new FormData();
    formData.append('action', action);
    formData.append('thing_id', thing_id);
    formData.append('sign', sign);
    formData.append('value', value);
    formData.append('table', 'posts');
    fetch('/interactions', {
        method: 'POST',
        body: formData,
    });
    //two reloads to make sure it actually works
    
};




</script>
{% endblock %}

